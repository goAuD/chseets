<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>chseets • Browse Printable Cheat Sheets</title>
  <meta name="description" content="Browse and download printable cheat sheets. Find study guides, quick reference sheets, and learning materials for any subject.">
  <meta name="keywords" content="cheat sheets, printable, study guides, learning, reference">
  <meta name="author" content="chseets">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="chseets • Browse Printable Cheat Sheets">
  <meta property="og:description" content="Browse and download printable cheat sheets for any subject.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://chseets.com/sheets/">
  <meta property="og:image" content="https://chseets.com/assets/icons/icon-512.png">
  <link rel="canonical" href="https://chseets.com/sheets/">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/assets/icons/icon-192.png">
  <meta name="theme-color" content="#0c0f13">
  <link rel="stylesheet" href="/assets/css/wasd.css">
  <script>if('serviceWorker'in navigator){addEventListener('load',()=>navigator.serviceWorker.register('/sw.js'))}</script>
</head>
<body>

  <header class="header">
    <div class="container nav">
      <div class="brand">
        <a href="/"><img class="logo" src="/assets/icons/icon-192.png" alt="chseets"></a>
        <h1 class="title">chseets</h1>
      </div>
    <div class="navlinks">
      <div class="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="11" cy="11" r="7" stroke="#9aa6ad" stroke-width="2"/><path d="M20 20L16.65 16.65" stroke="#9aa6ad" stroke-width="2"/>
        </svg>
        <input placeholder="Search sheets…" aria-label="Search sheets">
      </div>
      <a class="btn" href="/sheets/">Sheets</a>
      <a class="btn" href="/about/">About</a>
      <a class="btn" href="/api/">API</a>
      <a class="btn" href="/profile/">Account</a>
    </div>
  </div>
</header>

<main class="container section">
  <div class="card">
    <h2>Sheets</h2>

    <div style="margin:12px 0;display:flex;gap:8px;align-items:center" class="filter-sort-container">
      <input id="filter" placeholder="Filter by name or tag…"
        style="flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--fg)">
      <select id="sort" style="padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--fg)">
        <option value="new">Newest</option>
        <option value="az">A → Z</option>
        <option value="downloads">Most downloaded</option>
      </select>
    </div>

    <div id="public-grid" class="cards-grid"></div>
  </div>
</main>

<footer class="footer">
  <div class="container footer cols">
    <div>
      <strong>Product</strong><br>
      <a href="/about/">About</a><br>
      <a href="/api/">API</a>
    </div>
    <div>
      <strong>Account</strong><br>
      <a href="/profile/">Profile</a><br>
      <a href="/profile/">Sign in</a>
    </div>
    <div>
      <strong>Legal</strong><br>
      <a href="/legal/imprint.html">Imprint</a><br>
      <a href="/legal/privacy.html">Privacy Policy</a><br>
      <a href="/legal/terms.html">Terms of Use</a>
    </div>
    <div>
      <strong>Contact</strong><br>
      <a href="/legal/contact.html">General contact</a><br>
      <a href="/legal/partners.html">Partnership</a>
    </div>
  </div>
</footer>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
  const supabase = createClient("https://zpvqcjrtsbznaaphjhug.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpwdnFjanJ0c2J6bmFhcGhqaHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjM3MDcsImV4cCI6MjA3NjE5OTcwN30.pICNfmmQTvXz-TcLHTFI5EaXWtVV_DUGK7wjufVFjuc");
  const grid = document.getElementById('public-grid');
  const filter = document.getElementById('filter');
  const sortSel = document.getElementById('sort');
  const headerSearch = document.querySelector('.search input');
  const human = n=>{if(n==null)return'';const u=['B','KB','MB','GB'];let i=0;while(n>1024&&i<u.length-1){n/=1024;i++;}return `${n.toFixed(1)} ${u[i]}`;};

  let items = [];
  async function load(){
    const { data, error } = await supabase.from('sheets_meta')
      .select('slug,title,description,tags,lang,storage_path,preview_path,downloads,created_at')
      .eq('published', true).limit(500);
    if (error){ grid.innerHTML = `<div class="small">Error: ${error.message}</div>`; return; }
    items = data || [];
    render();
  }
  function publicUrl(path){
    return supabase.storage.from('sheets').getPublicUrl(path).data.publicUrl;
  }
  const hasDownloads = items.length && typeof items[0].downloads !== 'undefined';
  if (!hasDownloads && sortSel.value === 'downloads') sortSel.value = 'new';
    
  function render(){
    const q = (filter.value||'').toLowerCase();
    let rows = items.filter(r => r.title.toLowerCase().includes(q) || (r.tags||[]).join(' ').toLowerCase().includes(q));

    const sort = sortSel.value;
    if (sort==='az') rows.sort((a,b)=>a.title.localeCompare(b.title));
    else if (sort==='downloads') rows.sort((a,b)=>(b.downloads||0)-(a.downloads||0));
    else rows.sort((a,b)=> new Date(b.created_at)-new Date(a.created_at));

    grid.innerHTML = rows.map(r=>{
      const url = publicUrl(r.storage_path);
      const thumbUrl = r.preview_path ? publicUrl(r.preview_path) : '';
      const tags = (r.tags||[]).slice(0,4).map(t=>`<span class="small" style="opacity:.7">#${t}</span>`).join(' ');
      return `
        <div class="card-file">
          ${thumbUrl ? `<div class="thumb"><img src="${thumbUrl}" alt="${r.title}" loading="lazy"></div>` : `<div class="thumb" style="background:linear-gradient(135deg,#0d1218,#171b22)"></div>`}
          <div class="content">
            <div class="row">
              <div class="name">${r.title}</div>
            </div>
            <div>
              <div class="meta">${new Date(r.created_at).toLocaleDateString()}</div>
              <div class="actions" style="margin-top:8px">
                <a class="btn-sm" href="${url}" target="_blank">Open</a>
              </div>
            </div>
          </div>
        </div>`;
    }).join('') || '<div class="small">No public sheets yet.</div>';
  }
  filter.addEventListener('input', render);
  sortSel.addEventListener('change', render);
  headerSearch.addEventListener('input', (e) => {
    filter.value = e.target.value;
    render();
  });
  load();
  // ... a meglévő /sheets/ inline modulod alján, a load()/render() után:
  window.addEventListener('sheet:deleted', () => load());
  window.addEventListener('storage', (e) => {
    if (e.key === 'sheet:deleted') load();
  });
</script>
</body>
</html>

