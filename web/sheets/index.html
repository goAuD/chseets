<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>chseets • Browse Printable Cheat Sheets</title>
  <meta name="description"
    content="Browse and download printable cheat sheets. Find study guides, quick reference sheets, and learning materials for any subject.">
  <meta name="keywords" content="cheat sheets, printable, study guides, learning, reference">
  <meta name="author" content="chseets">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="chseets • Browse Printable Cheat Sheets">
  <meta property="og:description" content="Browse and download printable cheat sheets for any subject.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://chseets.com/sheets/">
  <meta property="og:image" content="https://chseets.com/assets/icons/icon-512.png">
  <link rel="canonical" href="https://chseets.com/sheets/">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/assets/icons/icon-192.png">
  <meta name="theme-color" content="#0c0f13">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Share+Tech+Mono&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/wasd.css?v=20241206AI">
  <script type="module" src="/assets/js/app.js?v=20241206AM"></script>
</head>

<body>

  <header class="header">
    <div class="container nav">
      <div class="brand">
        <a href="/"><img class="logo" src="/assets/icons/icon-192.png" alt="chseets"></a>
        <h1 class="title">chseets</h1>
      </div>
      <div class="nav-right">
        <span class="user-display">User: <strong data-slot="user">Guest</strong></span>
        <button class="burger" aria-label="Toggle menu">
          <span></span><span></span><span></span>
        </button>
        <div class="navlinks" id="nav-menu">
          <div class="nav-main">
            <a class="btn" href="/">Home</a>
            <a class="btn" href="/sheets/">Sheets</a>
            <a class="btn" href="/about/">About</a>
            <a class="btn" href="/api/">API</a>
            <a class="btn" href="/pwa/">Install App</a>
            <a class="btn" href="/profile/">Account</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container section">
    <div class="card">
      <h2>Sheets</h2>
      <div class="filter-sort-container">
        <input id="filter" placeholder="Filter by name or tag…">
        <select id="sort">
          <option value="new">Newest</option>
          <option value="az">A → Z</option>
          <option value="downloads">Most downloaded</option>
        </select>
      </div>
      <div id="sheets-grid" class="sheets-carousel"></div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer-grid">
      <div class="footer-category">
        <h4>Product</h4>
        <a href="/about/">About</a>
        <a href="/api/">API</a>
      </div>
      <div class="footer-category">
        <h4>Account</h4>
        <a href="/profile/">Profile</a>
        <a href="/profile/">Sign in</a>
      </div>
      <div class="footer-category">
        <h4>Legal</h4>
        <a href="/legal/imprint.html">Imprint</a>
        <a href="/legal/privacy.html">Privacy Policy</a>
        <a href="/legal/terms.html">Terms of Use</a>
      </div>
      <div class="footer-category">
        <h4>Contact</h4>
        <a href="/legal/contact.html">General contact</a>
        <a href="/legal/partners.html">Partnership</a>
      </div>
    </div>
  </footer>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";
    const supabase = createClient(
      "https://zpvqcjrtsbznaaphjhug.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpwdnFjanJ0c2J6bmFhcGhqaHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjM3MDcsImV4cCI6MjA3NjE5OTcwN30.pICNfmmQTvXz-TcLHTFI5EaXWtVV_DUGK7wjufVFjuc"
    );

    const grid = document.getElementById('sheets-grid');
    const filter = document.getElementById('filter');
    const sortSel = document.getElementById('sort');

    let items = [];

    async function load() {
      console.log('[SHEETS] Loading sheets from Supabase...');
      const { data, error } = await supabase
        .from('sheets_meta')
        .select('slug,title,description,tags,lang,storage_path,preview_path,downloads,created_at')
        .eq('published', true)
        .order('created_at', { ascending: false })
        .limit(500);

      if (error) {
        console.error('[SHEETS] Error loading:', error);
        grid.innerHTML = `<div class="small">Error: ${error.message}</div>`;
        return;
      }
      items = data || [];
      console.log('[SHEETS] Loaded', items.length, 'sheets:', items);
      render();
    }

    function publicUrl(path) {
      if (!path) return '';
      return supabase.storage.from('sheets').getPublicUrl(path).data.publicUrl;
    }

    function render() {
      const q = (filter.value || '').toLowerCase();
      let rows = items.filter(r =>
        r.title.toLowerCase().includes(q) ||
        (r.tags || []).join(' ').toLowerCase().includes(q)
      );

      const sort = sortSel.value;
      if (sort === 'az') rows.sort((a, b) => a.title.localeCompare(b.title));
      else if (sort === 'downloads') rows.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));
      else rows.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

      if (!rows.length) {
        grid.innerHTML = '<div class="small">No public sheets yet.</div>';
        return;
      }

      grid.innerHTML = rows.map(r => {
        const url = publicUrl(r.storage_path);
        const thumbUrl = r.preview_path ? publicUrl(r.preview_path) : '';
        return `
          <a href="${url}" target="_blank" class="sheet-card">
            <div class="preview">
              ${thumbUrl ? `<img src="${thumbUrl}" alt="${r.title}" loading="lazy">` : `<div class="no-preview">No preview</div>`}
            </div>
            <div class="info">
              <div class="sheet-title" title="${r.title}">${r.title}</div>
              <div class="sheet-meta">${new Date(r.created_at).toLocaleDateString()}</div>
            </div>
          </a>`;
      }).join('');
    }

    filter.addEventListener('input', render);
    sortSel.addEventListener('change', render);
    load();

    window.addEventListener('sheet:deleted', () => load());
    window.addEventListener('storage', (e) => { if (e.key === 'sheet:deleted') load(); });
  </script>
</body>

</html>